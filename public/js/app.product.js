(function(){!function(){"use strict";var a,b;return a=window.myapp,a.model={},a.collection={},a.view={main:{},sub:{}},a.util={},b=Backbone.sync,Backbone.sync=function(a,c,d){var e,f,g;return d.error=function(){return window.location="#/error/"},g=function(){return b(a,c,d)},c.isSaveStorage?(f=d.success,"delete"===a?(d.success=function(a){return c.removeStorage(),f(a)},g()):"read"===a&&(e=c.getStorage(),null!=e)?f(e):(d.success=function(b){return c.saveStorage(a,b),f(b)},g())):g()}}()}).call(this),function(){(function(a){"use strict";var b;return b=function(){function a(){$.ajaxSettings.timeout=5e3,$.ajaxSettings.xhr=function(){var a;return a=new XMLHttpRequest}}return a.prototype.get=function(a,b){return this._ajax("get",a,b)},a.prototype.post=function(a,b){return this._ajax("post",a,b)},a.prototype.put=function(a,b){return this._ajax("put",a,b)},a.prototype["delete"]=function(a,b){return this._ajax("delete",a,b)},a.prototype._ajax=function(a,b,c){var d;return d=new Deferred,$.ajax({url:b,type:a,data:c,dataType:"json",success:function(a){return d.call(a)},error:function(a){return d.fail(a)}}),d},a}(),a.Http=new b}).call(this,myapp.util)}.call(this),function(){!function(){"use strict";var a,b;return b=this,a=function(){function a(){this.storage=sessionStorage}return a.prototype.get=function(a){return this.storage.getItem(a)},a.prototype.set=function(a,b){return this.storage.setItem(a,b)},a.prototype.remove=function(a){return this.storage.removeItem(a)},a.prototype.clear=function(){return this.storage.clear()},a}(),myapp.util.Storage=new a}()}.call(this),function(){(function(a,b){"use strict";return a.Base=Backbone.Model.extend({isSaveStorage:!1,storageKey:"",getStorage:function(){var a;return a=b.Storage.get(this.storageKey),null!=a?JSON.parse(a):void 0},saveStorage:function(a,c){return b.Storage.set(this.storageKey,JSON.stringify(c))},removeStorage:function(){return b.Storage.remove(this.storageKey)}})}).call(this,myapp.model,myapp.util)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};(function(a){"use strict";var c;return a.User=function(a){function d(){return c=d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.isSaveStorage=!0,d.prototype.urlRoot="/api/users/",d.prototype.initialize=function(a){return this.storageKey="model:user:"+a.id},d}(a.Base)}).call(this,myapp.model)}.call(this),function(){(function(a,b,c){"use strict";return b.Base=Backbone.Collection.extend({isSaveStorage:!1,storageKey:"",model:a.Base,getStorage:function(){var b,d,e,f,g,h;if(f=c.Storage.get(this.storageKey),null!=f){for(d=[],g=0,h=f.length;h>g;g++){if(e=f[g],a=new this.model({id:e}),b=c.Storage.get(a.storageKey),null==b)return;d.push(b)}return d}},saveStorage:function(b,d){var e,f,g,h;for(f=[],g=0,h=d.length;h>g;g++)e=d[g],f.push(e.id),a=new this.model({id:e.id}),c.Storage.set(a.storageKey,JSON.stringify(e));return c.Storage.set(this.storageKey,JSON.stringify(f))},removeStorage:function(){var b,d,e,f,g;for(d=c.Storage.get(this.storageKey),c.Storage.remove(this.storageKey),g=[],e=0,f=d.length;f>e;e++)b=d[e],a=new this.model({id:b}),g.push(c.Storage.remove(a.storageKey));return g}})}).call(this,myapp.model,myapp.collection,myapp.util)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};(function(a,c){"use strict";var d;return c.Users=function(c){function e(){return d=e.__super__.constructor.apply(this,arguments)}return b(e,c),e.prototype.isSaveStorage=!0,e.prototype.url="/api/users/",e.prototype.model=a.User,e.prototype.storageKey="collection:users",e}(c.Base)}).call(this,myapp.model,myapp.collection)}.call(this),function(){(function(a,b){"use strict";return a.Base=Backbone.View.extend({render:function(a){return this.$el.html(this.tmpl(a))}},{JST:function(a){return b[a]}})}).call(this,myapp.view,myapp.JST)}.call(this),function(){(function(a){"use strict";return a.MainView=a.Base.extend({el:$("#mainview")})}).call(this,myapp.view)}.call(this),function(){(function(a){"use strict";return a.SubView=a.Base.extend({el:$("#subview")})}).call(this,myapp.view)}.call(this),function(){(function(a,b){"use strict";return b.Default=a.extend({tmpl:a.JST("main/default"),show:function(a){return this.render(a)}})}).call(this,myapp.view.MainView,myapp.view.main)}.call(this),function(){(function(a,b){"use strict";return b.Top=a.extend({tmpl:a.JST("main/top")})}).call(this,myapp.view.MainView,myapp.view.main)}.call(this),function(){(function(a,b){"use strict";return b.Friends=a.extend({tmpl:a.JST("sub/friends"),show:function(a){return this.render({friends:a})}})}).call(this,myapp.view.SubView,myapp.view.sub)}.call(this),function(){(function(a,b){"use strict";return b.My=a.extend({tmpl:a.JST("sub/my"),show:function(a){return this.render(a)}})}).call(this,myapp.view.SubView,myapp.view.sub)}.call(this),function(){(function(a,b){"use strict";return b.Top=a.extend({tmpl:a.JST("sub/top")})}).call(this,myapp.view.SubView,myapp.view.sub)}.call(this),function(){(function(a,b,c){"use strict";var d;return d=Backbone.Router.extend({routes:{"":"top","my/":"my","friends/":"friends"},top:function(){return(new b.sub.Top).render(),(new b.main.Top).render()},my:function(){var c;return c=new a.User({id:1}),c.fetch({success:function(){var a;return a=c.toJSON(),(new b.main.Default).show(a),(new b.sub.My).show(a)}})},friends:function(){var d;return d=new c.Users,d.fetch({success:function(){var c;return(new b.sub.Friends).show(d.toJSON()),c=new a.User({id:1}),c.fetch({success:function(){return(new b.main.Default).show(c.toJSON())}})}})}}),myapp.Router=new d,Backbone.history.start()}).call(this,myapp.model,myapp.view,myapp.collection)}.call(this);